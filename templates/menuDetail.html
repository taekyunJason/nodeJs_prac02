<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <title>ë©”ë‰´ ìƒì„¸ë³´ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&display=swap" rel="stylesheet">

    <title>ë©”ë‰´ë³„ í•„ìš”ìˆ˜ëŸ‰</title>

    <style>
        * {
            font-family: 'Gowun Batang', serif;
            color: black;
        }

        body {
            background-position: center;
            background-size: cover;
        }

        h1 {
            font-weight: bold;
        }

        .order {
            width: 85%;
            margin: 60px auto 0px auto;
            padding-bottom: 60px;
        }

        .mybtn {
            width: 100%;
        }

        .mypost {
            width: 95%;
            max-width: 500px;
            margin: 20px auto 0px auto;
            padding: 20px;
            box-shadow: 0px 0px 3px 0px gray;

            display: none;
        }

        .order>table {
            margin: 40px 0;
            font-size: 18px;
        }

        option {
            color: black;
        }
    </style>
    <script>
        $(document).ready(function () {
            console.log(localStorage.getItem("token"))
            if (localStorage.getItem("token")) {
                getMenuDetail();
            }
        });

        function getMenuDetail() {
            let menuId = new URLSearchParams(location.search).get('menuId')
            console.log("menuId : ", menuId);

            $.ajax({
                headers: {
                    authorization: `Bearer ${localStorage.getItem("token")}`,
                },
                type: "GET",
                url: `/api/menuDetail?menuId=${menuId}`,
                data: {},
                success: function (response) {
                    console.log(response);
                    let rows = response;
                    let menuName = rows[0].menuName;
                    let institution = rows[0].institution;
                    let ingredient = rows[0].ingredient;
                    let onePerson = rows[0].onePerson;
                    let eatingNum = rows[0].eatingNum;
                    let expectAmount = (onePerson * eatingNum) / 1000;

                    console.log(menuName, institution, ingredient, onePerson, eatingNum, expectAmount)

                    let menuName_html = `<h1>[${menuName}]</h1>`
                    $('#putMenuName').append(menuName_html)

                    let menuInstitutionData_html = `${institution}`
                    $('#institutionDetail').append(menuInstitutionData_html)
                    let menuIngredientData_html = `${ingredient}`
                    $('#ingredientDetail').append(menuIngredientData_html)
                    let menuOnePersonData_html = `${onePerson}` + " [g]"
                    $('#onePersonDetail').append(menuOnePersonData_html)
                    let eatingNumData_html = `${eatingNum}` + " [ëª…]"
                    $('#eatingNumDetail').append(eatingNumData_html)
                    let expectAmountData_html = `${expectAmount}` + " [kg]"
                    $('#expectAmountDetail').append(expectAmountData_html)
                },
                error: function (error) {
                    alert(error.responseJSON.errorMessage);
                },
            });


        }

        function open_box() {
            $('#post-box').show()
        }

        function close_box() {
            $('#post-box').hide()
        }

        function save_order() {
            let menuId = new URLSearchParams(location.search).get('menuId')
            console.log("menuId : ", menuId);

            let menuName = $('#menuName').val()
            let ingredient = $('#ingredient').val()
            let onePerson = $('#onePerson').val()
            let eatingNum = $('#eatingNum').val()
            let institution = $('#institution').val()
            let additionalIngredient = $('#additionalIngredient').val()
            let additionalOnePerson = $('#additionalOnePerson').val()

            console.log("name: ", menuName, "ingredient: ", ingredient, "one: ", onePerson, "eating: ", eatingNum, "institution: ", institution)

            $.ajax({
                type: 'PATCH',
                url: `/api/menuDetail?menuId=${menuId}`,
                data: {
                    menuName: menuName,
                    ingredient: ingredient,
                    onePerson: onePerson,
                    eatingNum: eatingNum,
                    institution: institution,
                    additionalIngredient: additionalIngredient,
                    additionalOnePerson: additionalOnePerson,
                },
                success: function (response) {
                    alert("ë©”ë‰´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
                    window.location.reload()
                }
            })
        }

        function add_ingredient() {
            let temp_html =
                `<div class="input-group" style="margin-top: 20px">
                    <input id="additionalIngredient" type="text" class="form-control">
                    <input id="additionalOnePerson" type="text" class="form-control">
                    <button onclick="add_ingredient()" type="button" class="btn btn-dark">ì¶”ê°€í•˜ê¸°</button>
                </div>`
            $('#ingredientWithOnePerson').append(temp_html)
        }
    </script>
</head>

<body>
    <div class="mask"></div>
    <div class="order">
        <h1 id="putMenuName"></h1>
        <p>
            ê²€ìƒ‰í•œ ë©”ë‰´ ì •ë³´ë¥¼ ì•„ë˜ì—ì„œ í™•ì¸í•˜ì„¸ìš”! ğŸ˜ƒ<br />
            ë³€ê²½í•  ì‚¬í•­ì´ ìˆë‹¤ë©´ "ìˆ˜ì •í•˜ê¸°" ë²„íŠ¼ìœ¼ë¡œ ìˆ˜ì •í•´ë³´ì„¸ìš” :)
        </p><br />
        <div class="d-grid gap-2 col-6 mx-auto">
            <button class="btn btn-success" type="button" onclick="open_box()">ğŸ‘©ğŸ»â€ğŸ³ ë©”ë‰´ ìˆ˜ì •í•˜ê¸° â¬‡ï¸ ğŸ‘¨ğŸ»â€ğŸ³</button>
        </div>
        <br />
        <div class="mypost" id="post-box">
            <div class="input-group mb-3">
                <span class="input-group-text">ë©”ë‰´ ì´ë¦„</span>
                <input id="menuName" type="text" class="form-control">
            </div>

            <div class="input-group" style="margin-bottom: 20px">
                <span type="text" aria-label="Ingredient" class="input-group-text">ì‹ì¬ë£Œ</span>
                <span type="text" aria-label="OnePerson" class="input-group-text">1ì¸ëŸ‰(g)</span>
            </div>
            <div class="input-group" id="ingredientWithOnePerson" style="margin-bottom: 20px">

                <input id="ingredient" type="text" aria-label="First name" class="form-control">
                <input id="onePerson" type="text" aria-label="Last name" class="form-control">
                <button onclick="add_ingredient()" type="button" class="btn btn-dark">ì¶”ê°€í•˜ê¸°</button>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">ì‹ìˆ˜</span>
                <input id="eatingNum" type="text" class="form-control">
            </div>
            <div class="input-group mb-3">
                <label class="input-group-text" for="institution">ì‚¬ìš© ê¸°ê´€</label>
                <select class="form-select" id="institution">
                    <option value=""></option>
                    <option value="ì‚°ì—…ì²´">ì‚°ì—…ì²´</option>
                    <option value="ì´ˆë“±í•™êµ">ì´ˆë“±í•™êµ</option>
                    <option value="ì¤‘í•™êµ">ì¤‘í•™êµ</option>
                    <option value="ê³ ë“±í•™êµ">ê³ ë“±í•™êµ</option>
                    <option value="ì–´ë¦°ì´ì§‘">ì–´ë¦°ì´ì§‘</option>
                    <option value="ìš”ì–‘ë³‘ì›">ìš”ì–‘ë³‘ì›</option>

                </select>
            </div>
            <div class="mybtns">
                <button onclick="save_order()" type="button" class="btn btn-dark">ì €ì¥í•˜ê¸°</button>
                <button onclick="close_box()" type="button" class="btn btn-outline-dark">ë‹«ê¸°</button>
            </div>
        </div><br />

        <!-- <div class="order-info" id="menuInputBox">

            <div class="input-group mb-3">
                <span class="input-group-text">ë©”ë‰´ ì´ë¦„</span>
                <input id="menuName" type="text" class="form-control">
            </div>

            <div class="input-group" style="margin-bottom: 20px">
                <span type="text" aria-label="Ingredient" class="input-group-text">ì‹ì¬ë£Œ</span>
                <span type="text" aria-label="OnePerson" class="input-group-text">1ì¸ëŸ‰(g)</span>
            </div>
            <div class="input-group" id="ingredientWithOnePerson" style="margin-bottom: 20px">

                <input id="ingredient" type="text" aria-label="First name" class="form-control">
                <input id="onePerson" type="text" aria-label="Last name" class="form-control">
                <button onclick="add_ingredient()" type="button" class="btn btn-dark">ì¶”ê°€í•˜ê¸°</button>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">ì‹ìˆ˜</span>
                <input id="eatingNum" type="text" class="form-control">
            </div>
            <div class="input-group mb-3">
                <label class="input-group-text" for="institution">ì‚¬ìš© ê¸°ê´€</label>
                <select class="form-select" id="institution">
                    <option selected>-- ì‚¬ìš© ê¸°ê´€ --</option>
                    <option value="ì‚°ì—…ì²´">ì‚°ì—…ì²´</option>
                    <option value="ì´ˆë“±í•™êµ">ì´ˆë“±í•™êµ</option>
                    <option value="ì¤‘í•™êµ">ì¤‘í•™êµ</option>
                    <option value="ê³ ë“±í•™êµ">ê³ ë“±í•™êµ</option>
                    <option value="ì–´ë¦°ì´ì§‘">ì–´ë¦°ì´ì§‘</option>
                    <option value="ìš”ì–‘ë³‘ì›">ìš”ì–‘ë³‘ì›</option>

                </select>
            </div>
            <button onclick="save_order()" type="button" class="btn btn-warning mybtn">ìˆ˜ì •í•˜ê¸°</button>
        </div> -->
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">ì‚¬ìš© ê¸°ê´€</th>
                    <th scope="col">ì‹ì¬ë£Œ</th>
                    <th scope="col">1ì¸ëŸ‰ (g)</th>
                    <th scope="col">ì‹ìˆ˜ (ëª…)</th>
                    <th scope="col">ì˜ˆìƒ ì‚¬ìš©ëŸ‰ [1ì¸ëŸ‰ X ì‹ìˆ˜] (kg)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="col" id="institutionDetail"></th>
                    <th scope="col" id="ingredientDetail"></th>
                    <th scope="col" id="onePersonDetail"></th>
                    <th scope="col" id="eatingNumDetail"></th>
                    <th scope="col" id="expectAmountDetail"></th>
                </tr>
            </tbody>
        </table>
    </div>
</body>

</html>